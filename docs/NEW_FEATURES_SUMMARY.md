# –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ UKNF Report Desk

## –û–±–∑–æ—Ä

–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ UKNF Report Desk –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö. –≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç –∫–∞–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—ç–∫–µ–Ω–¥–∞ (auth-service), —Ç–∞–∫ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (React).

---

## 1. –ò–∑–º–µ–Ω–µ–Ω–∏—è –±—ç–∫–µ–Ω–¥–∞ (auth-service)

### 1.1. –ù–æ–≤—ã–π endpoint: GET /get-user-id-by-session/{session_id}

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID —Å–µ—Å—Å–∏–∏.

**–ü—É—Ç—å**: `GET /auth/get-user-id-by-session/{session_id}`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `session_id` (path parameter) - ID —Å–µ—Å—Å–∏–∏, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø—Ä–∏ –≤—Ö–æ–¥–µ

**–û—Ç–≤–µ—Ç**:
```json
{
  "user_id": 2,
  "session_id": "97f42ead-df0e-4c70-8e74-1a4def9d3dc2"
}
```

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```bash
# –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ auth-service
curl http://localhost:8001/get-user-id-by-session/{session_id}

# –ß–µ—Ä–µ–∑ frontend proxy
curl http://localhost:3000/auth/get-user-id-by-session/{session_id}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏**:
- `404 Not Found` - —Å–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –∏—Å—Ç–µ–∫–ª–∞
- `500 Internal Server Error` - –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

### 1.2. –£–ª—É—á—à–µ–Ω–Ω—ã–π endpoint: GET /me

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ, –≤–∫–ª—é—á–∞—è –∏–º—è, —Ñ–∞–º–∏–ª–∏—é –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—É–±—ä–µ–∫—Ç–∞.

**–ü—É—Ç—å**: `GET /auth/me`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `session_id` (query parameter) - ID —Å–µ—Å—Å–∏–∏

**–û—Ç–≤–µ—Ç**:
```json
{
  "user_id": 2,
  "email": "admin_uknf@example.com",
  "firstName": "UKNF",
  "lastName": "Administrator",
  "phone": null,
  "isActive": true,
  "subjectId": 1,
  "subjectName": "UrzƒÖd Komisji Nadzoru Finansowego",
  "uknfId": null
}
```

**–ü–æ–ª—è –æ—Ç–≤–µ—Ç–∞**:
- `user_id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `email` - email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `firstName` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ –ø–æ–ª—è `USER_NAME`)
- `lastName` - —Ñ–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ –ø–æ–ª—è `USER_LASTNAME`)
- `phone` - –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å null)
- `isActive` - –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `subjectId` - ID —Å—É–±—ä–µ–∫—Ç–∞, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–º–æ–∂–µ—Ç –±—ã—Ç—å null)
- `subjectName` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—É–±—ä–µ–∫—Ç–∞ (–∏–∑ –ø–æ–ª—è `NAME_STRUCTURE` —Ç–∞–±–ª–∏—Ü—ã `SUBJECTS`, –º–æ–∂–µ—Ç –±—ã—Ç—å null)
- `uknfId` - UKNF ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º–æ–∂–µ—Ç –±—ã—Ç—å null)

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```bash
# –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ auth-service
curl "http://localhost:8001/me?session_id={session_id}"

# –ß–µ—Ä–µ–∑ frontend proxy
curl "http://localhost:3000/auth/me?session_id={session_id}"
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏**:
- `401 Unauthorized` - session_id –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
- `404 Not Found` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `500 Internal Server Error` - –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

## 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### 2.1. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π API Client (frontend/src/services/api.ts)

–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–∞ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–∞ –≤ –∫–ª–∞—Å—Å `AuthAPI`:

#### getMe(sessionId: string)
```typescript
async getMe(sessionId: string) {
  return this.get<{
    user_id: number;
    email: string;
    firstName: string | null;
    lastName: string | null;
    phone: string | null;
    isActive: boolean;
    subjectId: number | null;
    subjectName: string | null;
    uknfId: string | null;
  }>('/me', { session_id: sessionId });
}
```

#### getUserIdBySession(sessionId: string)
```typescript
async getUserIdBySession(sessionId: string) {
  return this.get<{ user_id: number; session_id: string }>(
    `/get-user-id-by-session/${sessionId}`
  );
}
```

---

### 2.2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Zustand Store (frontend/src/stores/authStore.ts)

#### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ AuthState:
```typescript
interface AuthState {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
  firstName: string | null;
  lastName: string | null;
  subjectName: string | null;
  // ... –¥–µ–π—Å—Ç–≤–∏—è ...
}
```

#### –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è login:
–¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è endpoint `/me` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:

```typescript
login: async (email: string, password: string) => {
  // 1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ö–æ–¥
  const response = await authAPI.login(email, password);
  
  // 2. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const userDetails = await authAPI.getMe(response.session_id);
  
  // 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ store
  set({
    user,
    sessionId: response.session_id,
    role,
    isAuthenticated: true,
    firstName: userDetails.firstName,
    lastName: userDetails.lastName,
    subjectName: userDetails.subjectName,
  });
}
```

#### –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:
–ù–æ–≤—ã–µ –ø–æ–ª—è (`firstName`, `lastName`, `subjectName`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

---

### 2.3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π MainLayout (frontend/src/layouts/MainLayout.tsx)

#### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:
–í —à–∞–ø–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
1. **–ü–æ–ª–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—è –∏–∑ –ø–æ–ª–µ–π `firstName` –∏ `lastName`
2. **–ù–∞–∑–≤–∞–Ω–∏–µ —Å—É–±—ä–µ–∫—Ç–∞** - –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Å—É–±—ä–µ–∫—Ç—É
3. **–†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Ç.–¥.

**–ü—Ä–∏–º–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è**:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ UKNF Administrator                  ‚îÇ
‚îÇ UrzƒÖd Komisji Nadzoru Finansowego   ‚îÇ  ‚Üê –ù–∞–∑–≤–∞–Ω–∏–µ —Å—É–±—ä–µ–∫—Ç–∞
‚îÇ administrator                        ‚îÇ  ‚Üê –†–æ–ª—å
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞**:
```typescript
<div className="text-right">
  <p className="text-sm font-medium text-gray-900">
    {firstName && lastName 
      ? `${firstName} ${lastName}` 
      : user?.USER_NAME && user?.USER_LASTNAME
      ? `${user.USER_NAME} ${user.USER_LASTNAME}`
      : user?.EMAIL || 'User'}
  </p>
  {subjectName && (
    <p className="text-xs text-gray-600 mt-0.5">
      {subjectName}
    </p>
  )}
  <p className="text-xs text-gray-500 capitalize mt-0.5">
    {role?.replace('_', ' ')}
  </p>
</div>
```

---

## 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3.1. –¢–µ—Å—Ç–æ–≤—ã–µ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏

#### 1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–±–µ–∑ —Å—É–±—ä–µ–∫—Ç–∞):
- **Email**: `admin@example.com`
- **–ü–∞—Ä–æ–ª—å**: `admin`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç /me**:
  ```json
  {
    "firstName": "Default",
    "lastName": "Administrator",
    "subjectId": null,
    "subjectName": null
  }
  ```

#### 2. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä UKNF (—Å —Å—É–±—ä–µ–∫—Ç–æ–º):
- **Email**: `admin_uknf@example.com`
- **–ü–∞—Ä–æ–ª—å**: `password123`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç /me**:
  ```json
  {
    "firstName": "UKNF",
    "lastName": "Administrator",
    "subjectId": 1,
    "subjectName": "UrzƒÖd Komisji Nadzoru Finansowego"
  }
  ```

#### 3. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä Bank Pekao (—Å —Å—É–±—ä–µ–∫—Ç–æ–º):
- **Email**: `admin_pekao@example.com`
- **–ü–∞—Ä–æ–ª—å**: `password456`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç /me**:
  ```json
  {
    "firstName": "Bank Pekao",
    "lastName": "Administrator",
    "subjectId": 2,
    "subjectName": "Bank Polska Kasa Opieki Sp√≥≈Çka Akcyjna"
  }
  ```

---

### 3.2. –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –¢–µ—Å—Ç 1: –ü–æ–ª—É—á–µ–Ω–∏–µ user_id –ø–æ session_id
```bash
# –®–∞–≥ 1: –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
SESSION_ID=$(curl -s -X POST http://localhost:3000/auth/authn \
  -H "Content-Type: application/json" \
  -d '{"email": "admin_uknf@example.com", "password": "password123"}' | jq -r '.session_id')

# –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å user_id
curl "http://localhost:3000/auth/get-user-id-by-session/$SESSION_ID" | jq .
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
```json
{
  "user_id": 2,
  "session_id": "..."
}
```

#### –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
```bash
# –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
curl "http://localhost:3000/auth/me?session_id=$SESSION_ID" | jq .
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
```json
{
  "user_id": 2,
  "email": "admin_uknf@example.com",
  "firstName": "UKNF",
  "lastName": "Administrator",
  "phone": null,
  "isActive": true,
  "subjectId": 1,
  "subjectName": "UrzƒÖd Komisji Nadzoru Finansowego",
  "uknfId": null
}
```

#### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI
1. –í–æ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç `http://localhost:3000`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: `admin_uknf@example.com` / `password123`
3. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –¥–æ–ª–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è:
   - **–ò–º—è**: "UKNF Administrator"
   - **–°—É–±—ä–µ–∫—Ç**: "UrzƒÖd Komisji Nadzoru Finansowego"
   - **–†–æ–ª—å**: "administrator"

---

## 4. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### 4.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **Backend (auth-service/main.py)**:
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–∞ –Ω–æ–≤—ã—Ö endpoint'–∞
   - Endpoint `/me` –≤—ã–ø–æ–ª–Ω—è–µ—Ç JOIN –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ `USERS` –∏ `SUBJECTS`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

2. **Frontend (React/TypeScript)**:
   - –û–±–Ω–æ–≤–ª–µ–Ω API client —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏
   - Zustand store —Ä–∞—Å—à–∏—Ä–µ–Ω –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
   - MainLayout –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   - –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å TypeScript

### 4.2. –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      1. Login      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Browser   ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> ‚îÇ auth-service ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                                    ‚îÇ
       ‚îÇ         2. Return session_id       ‚îÇ
       ‚îÇ <‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ            3. Call /me
       ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>
       ‚îÇ                                    ‚îÇ
       ‚îÇ                             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ                             ‚îÇ   Redis     ‚îÇ
       ‚îÇ                             ‚îÇ  (session)  ‚îÇ
       ‚îÇ                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                                    ‚îÇ
       ‚îÇ                             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ                             ‚îÇ PostgreSQL  ‚îÇ
       ‚îÇ                             ‚îÇ (users +    ‚îÇ
       ‚îÇ                             ‚îÇ  subjects)  ‚îÇ
       ‚îÇ                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                                    ‚îÇ
       ‚îÇ    4. Return user details          ‚îÇ
       ‚îÇ <‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ    5. Update store & UI
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>
```

---

## 5. –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

### Backend:
- ‚úÖ `auth-service/main.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ endpoints

### Frontend:
- ‚úÖ `frontend/src/services/api.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ API –º–µ—Ç–æ–¥—ã
- ‚úÖ `frontend/src/stores/authStore.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω store —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
- ‚úÖ `frontend/src/layouts/MainLayout.tsx` - –æ–±–Ω–æ–≤–ª–µ–Ω UI –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

---

## 6. –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –§—É–Ω–∫—Ü–∏—è | Backend | Frontend | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---------|---------|----------|--------------|--------|
| GET /get-user-id-by-session | ‚úÖ | ‚úÖ | ‚úÖ | –ì–æ—Ç–æ–≤–æ |
| GET /me (enhanced) | ‚úÖ | ‚úÖ | ‚úÖ | –ì–æ—Ç–æ–≤–æ |
| –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π authStore | N/A | ‚úÖ | ‚úÖ | –ì–æ—Ç–æ–≤–æ |
| –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI | N/A | ‚úÖ | ‚úÖ | –ì–æ—Ç–æ–≤–æ |

---

## 7. –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   - –†–∞—Å—à–∏—Ä–∏—Ç—å endpoint `/me` –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ URL —Ñ–æ—Ç–æ
   - –û–±–Ω–æ–≤–∏—Ç—å UI –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞

2. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∞–≤–∞—Ö –¥–æ—Å—Ç—É–ø–∞**
   - –†–∞—Å—à–∏—Ä–∏—Ç—å endpoint `/me` –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≥—Ä—É–ø–ø –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TTL –∫—ç—à –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

4. **–î–æ–±–∞–≤–∏—Ç—å webhook –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebSocket –¥–ª—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

---

## 8. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:

‚úÖ **Backend**: –ù–æ–≤—ã–π endpoint `/get-user-id-by-session/{session_id}` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚úÖ **Backend**: –£–ª—É—á—à–µ–Ω–Ω—ã–π endpoint `/me` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç firstName, lastName –∏ subjectName  
‚úÖ **Frontend**: Zustand store –æ–±–Ω–æ–≤–ª–µ–Ω —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏  
‚úÖ **Frontend**: Login –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `/me` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ  
‚úÖ **Frontend**: MainLayout –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–æ–ª–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—É–±—ä–µ–∫—Ç–∞  

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ

